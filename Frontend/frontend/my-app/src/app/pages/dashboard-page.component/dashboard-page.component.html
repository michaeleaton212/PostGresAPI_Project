<div class="page">
  <div class="page-header">
    <div class="user-info" *ngIf="userName">
      <span i18n="@@dashboard.loggedInAs">Logged in as:</span> <strong>{{ userName }}</strong>
    </div>
    <button class="back-button hide-mobile" (click)="goBackLogin()" i18n="@@dashboard.logout">Logout</button>
  </div>

  <!-- Booking overview -->
  <div class="overview">
    <h3 i18n="@@dashboard.myBookings">My Bookings</h3>

    <div class="activeBookings" i18n>
      {{ bookings.length }} booking(s)
    </div>

    <div class="overview-table">
      <!-- Überschriften -->
      <div class="overview-header">
        <div i18n>Name</div>
        <div i18n>Room</div>
        <div i18n>Start date</div>
        <div i18n>End date</div>
        <div i18n>Booking number</div>
        <div i18n>Status</div>
        <div i18n>Check in</div>
        <div i18n>Cancel</div>
        <div i18n>View</div>
      </div>

      <!-- Dynamische Daten -->
      <div class="overview-row"
           *ngFor="let b of bookings"
           [class.cancelled-row]="isCancelled(b)"
           [class.expired-row]="isExpired(b)">

        <div data-label="Name:" i18n-data-label>
          <span class="value-text" [title]="b.name">{{ b.name }}</span>
        </div>

        <div data-label="Room:" i18n-data-label>
          <span class="value-text" [title]="b.roomName">{{ b.roomName }}</span>
        </div>

        <div data-label="Start date:" i18n-data-label>
          <span class="value-text"
                [title]="b.startDate | date: 'dd.MM.yyyy'">
            {{ b.startDate | date: 'dd.MM.yyyy' }}
          </span>
        </div>

        <div data-label="End date:" i18n-data-label>
          <span class="value-text"
                [title]="b.endDate | date: 'dd.MM.yyyy'">
            {{ b.endDate | date: 'dd.MM.yyyy' }}
          </span>
        </div>

        <div data-label="Booking number:" i18n-data-label>
          <span class="value-text" [title]="b.bookingNumber">
            {{ b.bookingNumber }}
          </span>
        </div>

        <!-- Status Button -->
        <div data-label="Status:" i18n-data-label>
          <button class="status-button"
                  [ngClass]="{
              'status-checked': isCheckedIn(b),
              'status-not-checked': !isCheckedIn(b) && !isCancelled(b),
              'status-pending': b.status === BookingStatus.Pending,
              'status-cancelled': isCancelled(b)
            }"
                  [title]="getStatusText(b.status)">
            {{ getStatusText(b.status) }}
          </button>
        </div>

        <!-- Toggle Einchecken/Auschecken -->
        <div data-label="Check in:" i18n-data-label>
          <div class="toggle" [class.disabled]="isCancelled(b) || isExpired(b) || isCheckedIn(b)">
            <input type="checkbox"
                   [id]="'checkin-' + b.bookingNumber"
                   [checked]="isCheckedIn(b)"
                   [disabled]="isCancelled(b) || isExpired(b) || isCheckedIn(b)"
                   (change)="toggleCheckIn(b)" />
            <label [for]="'checkin-' + b.bookingNumber"></label>
          </div>
        </div>

        <!-- Stornieren -->
        <div data-label="Cancel:" i18n-data-label>
          <button class="stornieren"
                  (click)="cancelBooking(b.bookingNumber)"
                  [disabled]="isCancelled(b) || isExpired(b)"
                  i18n>
            { isCancelled(b), select,
            true {Cancelled}
            false {Cancel}
            }
          </button>
        </div>

        <!-- Zimmer ansehen -->
        <div data-label="View room:" i18n-data-label>
          <button class="zimmer-ansehen"
                  (click)="viewRoom(b)"
                  i18n>
            View room
          </button>
        </div>
      </div>
    </div>

    <!-- Logout Button für Mobile -->
    <div class="mobile-logout-wrapper show-mobile">
      <button class="mobile-logout-button" (click)="goBackLogin()" i18n="@@dashboard.logout">Logout</button>
    </div>
  </div>

  <!-- Cancel Confirmation Popup -->
  <div class="popup-overlay" *ngIf="showCancelPopup" (click)="closeCancelPopup()">
    <div class="popup-dialog" (click)="$event.stopPropagation()">
      <div class="popup-title" i18n>
        Möchten Sie die Buchung {{ pendingCancelBookingNumber }} wirklich stornieren?
      </div>
      <div class="popup-buttons">
        <button class="popup-btn popup-btn-confirm" (click)="closeCancelPopup()" i18n>
          Abbrechen
        </button>
        <button class="popup-btn popup-btn-cancel" (click)="confirmCancelBooking()" i18n>
          Stornieren
        </button>
      </div>
    </div>
  </div>

  <div class="footer-wrapper">
    <app-footer></app-footer>
  </div>
</div>
