<div class="page">
  <div class="toolbar">
    <h2>Users</h2>
    <div class="toolbar-actions">
      <button class="btn primary" (click)="toggleCreate()">Neuen User</button>
      <button class="btn" (click)="load()" [disabled]="loading">
        {{ loading ? 'Lädt...' : 'Aktualisieren' }}
      </button>
    </div>
  </div>

  <div *ngIf="showCreate" class="create-form">
    <form (submit)="onSubmit($event)" class="form">
      <label class="form-field">
        Name<br />
        <input name="name" required />
      </label>
      <label class="form-field">
        Email<br />
        <input name="email" type="email" required />
      </label>
      <div class="form-actions">
        <button class="btn primary" type="submit">Erstellen</button>
      </div>
    </form>
  </div>

  <div *ngIf="loading" class="empty">Lade Daten…</div>

  <div *ngIf="error" class="empty">
    Fehler beim Laden: {{ errorMessage }}
    <div class="retry">
      <button class="btn" (click)="load()">Wiederholen</button>
    </div>
    <pre class="error-detail">{{ error | json }}</pre>
  </div>

  <div *ngIf="!loading && !error">
    <div *ngIf="!users || users.length === 0" class="empty">Keine Benutzer gefunden.</div>

    <ul *ngIf="users && users.length > 0" class="user-list">
      <li *ngFor="let u of users; trackBy: trackById"
          class="user-item">
        <div class="user-meta">
          <div class="user-name">{{ u.UserName || u.userName || u.name || '—' }}</div>
          <div class="user-sub">
            {{ u.Email || u.email }}
            <span *ngIf="u.Phone || u.phone">• {{ u.Phone || u.phone }}</span>
          </div>

          <div *ngIf="validationErrors && validationErrors[u.id]" class="validation-error">
            {{ validationErrors[u.id] | json }}
          </div>
        </div>

        <div class="actions">
          <button class="btn" (click)="onEdit(u)">Bearbeiten</button>
          <button class="btn" (click)="onDelete(u.id)">Löschen</button>
        </div>
      </li>
    </ul>
  </div>
</div>
