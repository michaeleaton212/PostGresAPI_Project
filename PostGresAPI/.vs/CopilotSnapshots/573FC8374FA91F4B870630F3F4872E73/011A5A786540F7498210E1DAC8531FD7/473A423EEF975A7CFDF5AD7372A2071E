using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using PostGresAPI.Models;
using PostGresAPI.Repository;
using PostGresAPI.Contracts;
using PostGresAPI.Extensions;

namespace PostGresAPI.Services
{
    public class MeetingroomService : IMeetingroomService
    {
        private readonly IMeetingroomRepository _repo;
        public MeetingroomService(IMeetingroomRepository repo) => _repo = repo;

        // mapping
        private static MeetingroomDto ToDto(Meetingroom m)
            => new MeetingroomDto(m.Id, m.Name, m.NumberOfChairs);

        // Read
        public async Task<List<MeetingroomDto>> GetAll()
            => (await _repo.GetAll()).Select(ToDto).ToList();

        public async Task<MeetingroomDto?> GetById(int id)
            => (await _repo.GetById(id)) is { } m ? ToDto(m) : null;

        // Create
        public async Task<MeetingroomDto> Create(CreateMeetingroomDto createMeetingroomDto)
        {
            var created = await _repo.Add(createMeetingroomDto);
            return ToDto(created);
        }

        // Update
        public async Task<MeetingroomDto?> Update(int id, UpdateMeetingroomDto updateMeetingroomDto)
        {
            var updated = await _repo.Update(id, updateMeetingroomDto.Name, updateMeetingroomDto.NumberOfChairs);
            return updated is null ? null : ToDto(updated);
        }

        // Delete
        public Task<bool> Delete(int id) => _repo.Delete(id);
    }
}
